detect:
  events: [NEW_PROCESS, EXISTING_PROCESS]
  op: and
  rules:
  - {op: is windows}
  - op: or
    rules:
    - op: and
      rules:
      - {case sensitive: false, op: ends with, path: event/FILE_PATH, value: \odbcconf.exe}
      - op: or
        rules:
        - {case sensitive: false, op: contains, path: event/COMMAND_LINE, value: -f}
        - {case sensitive: false, op: contains, path: event/COMMAND_LINE, value: regsvr}
    - op: and
      rules:
      - {case sensitive: false, op: ends with, path: event/PARENT/FILE_PATH, value: \odbcconf.exe}
      - {case sensitive: false, op: ends with, path: event/FILE_PATH, value: \rundll32.exe}
respond:
- action: report
  metadata:
    author: Kirill Kiryanov, Beyu Denis, Daniil Yugoslavskiy, oscd.community
    description: Detects defence evasion attempt via odbcconf.exe execution to load
      DLL
    level: medium
    references: ['https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Odbcconf.yml',
      'https://twitter.com/Hexacorn/status/1187143326673330176']
    tags: [attack.defense_evasion, attack.execution, attack.t1218]
  name: Possible Application Whitelisting Bypass via dll loaded by odbcconf.exe

