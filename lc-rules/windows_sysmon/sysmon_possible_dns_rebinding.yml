detect:
  log type: wel
  op: and
  rules:
  - case sensitive: false
    op: is
    path: Event/System/EventID
    value: '22'
  - case sensitive: false
    op: ends with
    path: Event/EventData/QueryName
    value: ''
  - case sensitive: false
    op: is
    path: Event/EventData/QueryStatus
    value: '0'
  - op: or
    rules:
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).10\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).192\.168\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.16\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.17\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.18\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.19\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.20\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.21\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.22\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.23\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.24\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.25\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.26\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.27\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.28\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.29\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.30\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.31\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).127\..*
  - op: and
    rules:
    - case sensitive: false
      op: is
      path: Event/System/EventID
      value: '22'
    - case sensitive: false
      op: ends with
      path: Event/EventData/QueryName
      value: ''
    - case sensitive: false
      op: is
      path: Event/EventData/QueryStatus
      value: '0'
  - not: true
    op: or
    rules:
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).10\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).192\.168\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.16\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.17\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.18\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.19\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.20\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.21\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.22\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.23\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.24\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.25\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.26\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.27\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.28\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.29\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.30\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).172\.31\..*
    - case sensitive: false
      op: matches
      path: Event/EventData/QueryResults
      re: \(\:\:ffff\:\).127\..*
  target: log
respond:
- action: report
  metadata:
    author: Ilyas Ochkov, oscd.community
    description: Detects several different DNS-answers by one domain with IPs from
      internal and external networks. Normally, DNS-answer contain TTL >100. (DNS-record
      will saved in host cache for a while TTL).
    level: medium
    references:
    - https://medium.com/@brannondorsey/attacking-private-networks-from-the-internet-with-dns-rebinding-ea7098a2d325
    tags:
    - attack.command_and_control
    - attack.t1043
  name: Possible DNS Rebinding

